import tweepy
import time
import os
from os import environ
from keep_alive import keep_alive
from replit import db

consumer_key=environ['consumer_key']
consumer_secret=environ['consumer_secret']
access_key=environ['access_key']
access_secret=environ['access_secret']

auth=tweepy.OAuthHandler(consumer_key,consumer_secret)
auth.set_access_token(access_key,access_secret)
api=tweepy.API(auth)

def direct_message():
  last_id=last_mention()
  #same_id=same()
  print(last_id)
  print(same_id)
  if not(last_id==same_id):
    all_mention=api.mentions_timeline(last_id,tweet_mode="extended")
    for mention in (all_mention):
      text=mention.full_text.lower()
      if '#scrap' in text and not(same_id==mention.id):
        original_id=mention.in_reply_to_status_id
        tweet=api.get_status(original_id,tweet_mode='extended')
        a=tweet.full_text
        recipient_name=mention.user.screen_name
        user=api.get_user(recipient_name)
        id=user.id_str
        api.send_direct_message(id,a) 

 

def same():
  all_mention=api.mentions_timeline()
  for mention in (all_mention):
    return mention.id

def last_mention():
  all_mention=api.mentions_timeline()
  i=0
  for mention in (all_mention):
    if i==1:
      last_id=mention.id
      return last_id
    i=i+1
while True:
  direct_message()
  time.sleep(15)
